<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="viewport" content="target-densitydpi=device-dpi">
  <title>spa.js(3.0.0) 中文文档</title>
  <style>
    body{font-size:14px;line-height:22px;background-color:#f4f4f4;color:#000;font-family:"Helvetica Neue","Microsoft Yahei",Helvetica,Arial;}
    .interface{font-family:"Lucida Grande","Lucida Sans Unicode",Helvetica,Arial,sans-serif !important;}
    div#sidebar{background:#fff;position:fixed;top:0;left:0;bottom:0;width:200px;overflow-y:auto;overflow-x:hidden;-webkit-overflow-scrolling:touch;padding:15px 0 30px 30px;border-right:1px solid #bbb;box-shadow:0 0 20px #ccc;-webkit-box-shadow:0 0 20px #ccc;-moz-box-shadow:0 0 20px #ccc;}
    a.toc_title,a.toc_title:visited{display:block;color:black;font-weight:bold;margin-top:15px;}
    a.toc_title:hover{text-decoration:underline;}
    #sidebar .version{font-size:10px;font-weight:normal;}
    ul.toc_section{font-size:11px;line-height:14px;margin:5px 0 0 0;padding-left:0px;list-style-type:none;font-family:Lucida Grande,"Microsoft Yahei";}
    .toc_section li{cursor:pointer;margin:0 0 3px 0;}
    .toc_section li a{text-decoration:none;color:black;}
    .toc_section li a:hover{text-decoration:underline;}
    div.container{width:728px;margin:40px 0 50px 260px;}
    div.warning{margin-top:15px;font:bold 11px Arial;color:#770000;}
    p{margin:20px 0;width:728px;}
    a,a:visited{color:#444;}
    a:active,a:hover{color:#000;}
    h1,h2,h3,h4,h5,h6{padding-top:20px;}
    h2{font-size:20px;}
    b.header{font-size:16px;line-height:30px;}
    span.alias{font-size:14px;font-style:italic;margin-left:20px;}
    table,tr,td{margin:0;padding:0;}
    td{padding:2px 12px 2px 0;}
    table .rule{height:1px;background:#ccc;margin:5px 0;}
    ul{list-style-type:circle;padding:0 0 0 20px;}
    li{margin-bottom:10px;}
    code,pre,tt{font-family:Monaco,Consolas,"Lucida Console","Microsoft Yahei",monospace;font-size:12px;line-height:20px;font-style:normal;}
    tt{padding:0px 3px;background:#fff;border:1px solid #ddd;zoom:1;}
    code{margin-left:20px;}
    pre{font-size:12px;padding:2px 0 2px 15px;border-left:5px solid #bbb;margin:0px 0 30px;}
    pre>i{color:#888;}
    pre>b{color:#f00;font-weight:bold;}
    @media only screen and (-webkit-min-device-pixel-ratio:1.5) and (max-width:640px),only screen and (-o-min-device-pixel-ratio:3/2) and (max-width:640px),only screen and (min-device-pixel-ratio:1.5) and (max-width:640px){
        img{max-width:100%;}
        div#sidebar{-webkit-overflow-scrolling:initial;position:relative;width:90%;height:120px;left:0;top:-7px;padding:10px 0 10px 30px;border:0;}
        div.container{margin:0;width:100%;}
        p,div.container ul{max-width:98%;overflow-x:scroll;}pre{overflow:scroll;}
    }
  </style>
</head>
<body>
  <div id="sidebar" class="interface">
    <a class="toc_title" href="#">spa.js <span class="version">(3.0.0)</span></a>
    <ul class="toc_section">
      <li>» <a href="https://github.com/shusiwei/spajs">GitHub 仓库</a></li>
    </ul>
    <a class="toc_title" href="#introduction">介绍</a>
    <a class="toc_title" href="#read">阅读说明</a>
    <a class="toc_title" href="#installation">安装</a>
    <a class="toc_title" href="#use">使用</a>
    <a class="toc_title" href="#spa">class SPA</a>
    <ul class="toc_section">
      <li>» <a href="#constructor">构造函数</a></li>
      <li>» <a href="#router">路由</a></li>
      <li>» <a href="#start">开始</a></li>
    </ul>
    <a class="toc_title" href="#controller">应用控制器</a>
    <a class="toc_title" href="#webview">页面视图</a>
    <a class="toc_title" href="#template">模板</a>
    <a class="toc_title" href="#template">变更日志</a>
  </div>
  <div class="container" id="introduction">
    <p><a href="https://github.com/shusiwei/spajs">spa.js</a>一个SPA（Single Page Application）单页应用框架。</p>
    <p>spajs依赖于jQuery3</p>
    <p>spajs模板引擎使用<a href="http://olado.github.io/doT/">doT.js</a></p>
    <p>该项目代码<a href="https://github.com/shusiwei/spajs">托管在GitHub</a>上。</p>
    <div id="read">
      <h2>阅读说明</h2>
      <p><tt>function(a, b[, c, d])</tt> // 参数a, b 为必要参数，c, d为可选参数</p>
      <p><tt>* a = string ['app']</tt> // 参数a的数据类型为 string , 默认参数为'app'，* 代表必填参数, [] 代表参数默认值</p>
      <p>// 这是里条注释 [<tt>'route/a', 'route/old/a'</tt>] // 参数书写范例（仅限 [ ] 括号中的内容）</p>
    </div>
    <div class="installation" id="installation">
      <h2>安装</h2>
      <ul>
        <li>
          <b>git</b> <tt>git clone https://github.com/shusiwei/spajs.git</tt>
        </li>
        <li>
          <b>bower</b> <tt>bower install --save shusiwei/spajs</tt>
        </li>
      </ul>
    </div>
    <div id="use">
      <h2>使用（Use）</h2>
      <p>页面引入</p>
      <pre>
&lt;link rel="stylesheet" type="text/css" href="../js/spa.css"&gt;&lt;/link&gt; <i>// 引入样式</i>
&lt;script type="text/javascript" src="./js/spa.js"&gt;&lt;/script&gt; <i>// 引入JS文件</i>
</pre>
      <p>AMD&CMD</p>
      <pre>
// 引入SPA模块
var SPA = require('spa');
</pre>
      <p>初始化</p>
      <pre>
// 构建SPA应用
var APP = new SPA(project, config);

// 构建路由
var routes = APP.router(basePath);

// 添加路由规则
routes.push(routeName[, escape, preset, uri, templ, options]);

// 应用开始
APP.start(container[, storage, callback]);
</pre>
      <p>结果</p>
      <pre>
APP = {
  App : new WebApp = {
    ......(storage)<i>// 全局存储</i>,
    request(hash, state, source, data),
    redirect(hash, state, data),
    compile(templ, data),
    define(key, value),
    exec(callback)
  },
  project : project,
  version : '3.0.0',
  routes : new Router = {
    'routeNameA' : {...},
    'routeNameB' : {...},
    'routeNameC' : {...}
  } 
}
</pre>
    </div>
    <div id="documentation">
      <h2 id="spa">class SPA （SPA 类）</h2>
      <h3 id="constructor">constructor (构造函数)</h3>
      <pre>
  constructor(project, config);

  var <b>APP</b> = new SPA('project_name', {});

  * project = string <i>// 项目名称（英文）</i>
  * config = {
      prefix : string ['#!'] <i>// hash前缀</i>
      * name : string <i>// 项目名称（中文）</i>
      * version : 'string' <i>// 版本号 [a.b.c]</i>
      root : string ['./project/'] <i>// 项目根目录</i>
      apiType : string ['post'] <i>// 接口方法['post'/'get']</i>
      apiDataType : string ['json'] <i>// 接口数据类型</i>
      apiData : object [{}] <i>// 默认传输的数据</i>
      apiDataKey : string ['data'] <i>// 接口数据key名</i>
      apiMsgKey : string ['msg'] <i>// 接口数据描述key名</i>
      apiCodeKey : string ['status'] <i>// 接口数据状态码key名</i>
      timeout : number [15000] <i>// 接口超时时间</i>
      imgDir : string [root + 'img'] <i>// 图片根目录</i>
      jsDir : string [root + 'js'] <i>// JS根目录</i>
      tplDir : string [root + 'tpl'] <i>// 模板根目录</i>
      * debug : boolean <i>// 是否为debug模式</i>
      lifeCycle : number [90e3] <i>// 页面生命周期</i>
    }
</pre>
      <h3 id="router">router (路由)</h3>
      <pre>
  router(basePath);

  var <b>routes</b> = <b>APP</b>.router('http://api.domain.com/');

  * basePath = string ['/'] <i>// 接口根目录</i>

  返回一个路由集合对象 <b>routes</b>，路由中的相对路径的API地址都会默认在前面加上 'http://api.domain.com/';
</pre>
      <p>路由规则</p>
      <p>路由集合对象提供push方法可以增加新的路由规则，没有定义路由也能访问hash解析的页面</p>
      <pre>
  <b>routes</b>.push(routeName[, uri, escape, preset, options]);

  * routeName = string <i>// 路由路径 [路径 : 'news/article' 或 路径+参数 : 'news/article?:id'] 按参数多少匹配，由少至多匹配</i>
  uri = string <i>// api地址 ['list.php']，支持相对&绝对</i>
  escape = array <i>// 参数转换 ['apiParam => urlParam', 'apiParam1 => urlParam1']，如url为 #!id=18，escape = ['shop_id => id']，那么在接口中会以 'api.php?shop_id=18' 的形式传参</i>
  preset = string <i>// 参数预设 ['key=value&key=value']，如：url为 #!id=18&a=9，preset = 'a=1&b=2'，那么在接口中会以 'api.php?id=18&a=9&b=2' 的形式传参</i>
  options = { <i>// 其它选项</i>
    observer : boolean [false] <i>// 永远保持强制刷新</i>
    redirect : function(webview, App) { <i>// 重定向</i>
      return '#!new/hash/url' <i>// 返回重定向的地址</i>
    }
    proxy : function(result, webview, App) { <i>// API数据代理</i>
      ... <i>// 代码块</i>
    }
    render ：function(render, webview, App) { <i>// 渲染数据重组</i>
      ... <i>// 代码块</i>

      return { <i>// 返回的对象，此对象最终会与API传回的数据合并</i>
        key : value
      }
    }
    status : * <i>// 重定义页面正确的数据状态码</i>
    alias : string/array <i>// 路由别名 ['route/a', 'route/old/a']</i>
  }
</pre>
      <h3 id="start">start （开始）</h3>
      <p>执行此方法，SPA开始构建App，并加载显示页面</p>
      <pre>
  <b>APP</b>.start(container[, storage, callback]);

  * container = element <i>// webview容器</i>
  storage = object <i>// App全局存储</i>
  callback = { <i>// 回调</i>
    onReady : function(App) <i>// 初始化成功</i>
    onTransition : function(webview, App) <i>// 页面跳转回调</i>
  }
</pre>
      <h2 id="controller">APP.controller(window.App) 应用控制器</h2>
      <p>SPA构建后最终得到的是controller对象，controller基于WebApp类构建，它会以App的名称暴露在window中，controller本身成员对象是APP中的storage，以存储APP中所需要的值或方法</p>
      <p>controller提供了一些方法</p>
      <pre>
  controller.compile(templ[, data]) <i>// 渲染将一个模板字符串转代为html字符串</i>
  <i>如 ：</i> controller.compile('模板字符串', {渲染数据});

  * templ = string <i>// 模板字符串</i>
  data = object <i>// 渲染数据</i>
</pre>
      <pre>
  controller.define([key, value]) <i>// 定义一个值</i>
  <i>如 ：</i> controller.define('name', 'uhuibao'); <i>// {name : 'uhuibao'}</i>

  * key = string <i>// 值的名称</i>
  * value = * <i>// 保存的值</i>
  <i>// 如果没有参数，则得到整个被保存的数据</i>
      </pre>
      <pre>
  controller.exec(callback) <i>// 回调一个传入webview对象的函数</i>
  <i>如 ：</i> controller.exec(function(webview) {});

  * callback = function <i>// 值的名称</i>
</pre>
      <pre>
  controller.request(hash[, state, source, data]) <i>// 请求一个新的页面</i>
  <i>如 ：</i> controller.request('#!index');

  * hash = string <i>// 带有hash的url地址</i>
  state = number [当hash等于当前的hash的时候，默认值为 0，否则为 1 <i>// 拉入历史记录类型，0:自动 1:替换历史 2:拉入历史 3:不拉入历史</i>
  source = number <i>// 页面跳转类型 0:打开页面 1:链接跳转 2:历史跳转</i>
  data = object <i>// 页面默认的渲染数据</i>
</pre>
      <pre>
  controller.redirect(hash[, state, data]) <i>// 为页面做一个次url重定向跳转</i>
  <i>如 ：</i> controller.redirect('#!index');

  * hash = string <i>// 带有hash的url地址</i>
  state = number [1] <i>// 此参数参考controller.request</i>
  data = object <i>// 此参数参考controller.request</i>
</pre>
      <h2 id="webview">WebView 页面视图</h2>
      <p>spajs中，很个页面都是独立的webview对象，webview基于WebView类构建</p>
      <p>webview保存着页面中的所有信息</p>
      <pre>
  $webview : jQuery DOM <i>// 页面容器</i>
  hash : string <i>// 页面的hash地址</i>
  path : string <i>// 页面的路径</i>
  prop : { <i>// 页面中的静态属性</i>
    count : 0 <i>// 页面打开次数</i>
    scrollY : 0 <i>// 滚动条位置</i>
    status : "active" <i>// 页面状态</i>
    timer : 0 <i>// 页面挂起后的计时</i>
  }
  query : object/null <i>// 页面url中的参数，如果没有参数，则为null</i>
  render : object <i>// 渲染页面的数据</i>
  route : object <i>// 页面使用的路由规则，请参考<b>Router</b></i>
  runtime : {
    callback : function(webview, App) <i>// 页面加载完的回调函数</i>
    dataXHR : xhr <i>// 数据加载xhr对象</i>
    destroy : Array <i>// 页面销毁时执行的函数集合</i>
    enter : Array <i>// 页面进入时执行的函数集合</i>
    leave : Array <i>// 页面离开时执行的函数集合</i>
    tplXHR : xhr <i>// 模板加载xhr对象</i>
  }
  search : string ['none'] <i>// 页面url中的查询参数字符串</i>
  state : object <i>// 页面数据储存，每次页面销毁时此对象也将被销毁</i>
  templ : array <i>// 页面包含的模版字符串</i>
</pre>
      <p>webview提供了一此操作页面的方法</p>
      <pre>
  webview.on(type, fn) <i>// 页面事件绑定，分别是页面进入时，页面离开时，页面销毁时</i>

  * type = string <i>// webview绑定的事件，enter:页面进入时 leave:页面离开时 die:页面销毁时</i>
  * fn = function <i>// 触发事件后执行的函数</i>
</pre>
      <pre>
  webview.setState([key, value]) <i>// 为webview.state设直一个值</i>
  <i>如</i> webview.setState('name', 'uhuibao');
  <i>如</i> webview.setState('name'); <i>// 'uhuibao'</i>
  <i>如</i> webview.setState({a : 1, b : 2}); <i>// {name : 'uhuibao', a : 1, b : 2}</i>
  <i>如</i> webview.setState({a : 3, b : 4}, {c : 5, d : 6}); <i>// {name : 'uhuibao', a : 3, b : 4, c : 5, d : 6}</i>
  <i>如</i> webview.setState(); <i>// {name : 'uhuibao', a : 3, b : 4, c : 5, d : 6}</i>

  key = string/object <i>// 值的名称，当key是一个对象时，则保存整个对象，同时此方法后面的参数也只能为1个或多个对象，当key是一个字符串时，value为要保存的值，如果value参数没有，则返回webview.state[key]的值</i>
  value = * <i>// 保存的值</i>
  <i>// 如果没有任何参数时，则返回整个webview.state</i>
</pre>
      <h2 id="template">Template 模板</h2>
      <p>spajs模板引擎使用<a href="http://olado.github.io/doT/">doT.js</a></p>
      <p>页面中的链接可以使用两种方式</p>
      <pre>
  &lt;a href="#!index"&gt;
  &lt;a data-hash="index"&gt;
</pre>
      <p>页面链接可以定义拉入历史记录类型 <i>// 参考 APP.controller.request 方法</i></p>
      <pre>
  <i>如</i> &lt;a data-hash="index" data-sate="3"&gt; <i>或又如</i> &lt;a href="index" data-sate="2"&gt;
</pre>
      <p>SPA默认暴露的渲染数据有</p>
      <pre>
  {{=it.PROJECT_NAME}} <i>// 项目名称</i>
  {{=it.PROJECT_DIR}} <i>// 项目目录</i>
  {{=it.IMG_DIR}} <i>// 图像目录</i>
  {{=it.JS_DIR}} <i>// JS目录</i>
  {{=it.HASH_PREFIX}} <i>// hash前缀</i>
</pre>
      <p>自定义的模版标签有</p>
      <pre>
  {{#header}} <i>// 生成 &lt;header class="page-header backdrop"&gt;&lt;/header&gt;</i>
  {{#container}} <i>// &lt;div class="page-container"&gt;&lt;/div&gt;</i>
  {{#title#}} <i>// &lt;span class="page-title"&gt;{{=it.TITLE}}&lt;/span&gt;</i>
  {{#title}}{{title#}} <i>// &lt;span class="page-title"&gt;&lt;/span&gt;</i>
  {{#back#}} <i>// &lt;a data-rel="back" class="app-ui-icon app-icon-back icon back"&gt;&lt;/a&gt;</i>
  {{#forward#}} <i>// &lt;a data-rel="forward" class="app-ui-icon app-icon-forward icon forward"&gt;&lt;/a&gt;</i>
  {{#home#}} <i>// &lt;a data-rel="home" class="app-ui-icon app-icon-home icon home"&gt;&lt;/a&gt;</i>
</pre>
      <p>template 标签属性</p>
      <pre>
  &lt;template data-title="标题文字"&gt; <i>// 页面标题</i>
</pre>
      <h2 id="api">API 接口</h2>
      <p>spajs 数据基于接口 ajax，接口返回的数据必须遵守以下格式，key名的修改请参照 <a href="#spa">SPA 构造函数</a></p>
      <pre>
  {
    status : number/string/boolean [1] <i>// 状态码</i>
    msg : string <i>// 状态描述</i>
    data : { <i>// 接口数据，值必须为一个object对象</i>
      status : 0  <i>// 当求一个绝对数据如：?id=8，而数据库中不存在id为8的数据，此时应该返回空数据，此时则需要status为0，webview将会跳转到404页面</i>
    }
  }
</pre>
      <h2 id="changelog">Change Log</h2>
        <p id="3.0.0">
          <b class="header">3.0.0</b> — <small><i>2016.8.24</i></small>
        </p>
        <ul>
          <li>基于ES6的代码重组</li>
          <li>变更了webview.on方法</li>
        </ul>
    </div>
  </div>
</body>
</html>