"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();!function(e,t,r){return e.spajs?e.spajs:void("function"==typeof define&&define.amd?define(["jquery"],function($){return t(e,$,r(e))}):"function"==typeof define&&define.cmd?define(function(require,exports,module){module.exports=t(e,require("jquery"),r(e))}):e.SPA=t(e,e.jQuery,r(e)))}(window,function(e,$,t){var r=function(e,t){var r=Object.prototype.toString.call(t).toLowerCase().slice(8,-1);switch(e){case"undefined":return void 0===t;case"null":return null===t;case"object":return t&&r===e;case"number":case"array":case"string":case"function":case"boolean":return r===e;default:return!1}},n=function(){return r("object",arguments[0])},a=function(){return r("number",arguments[0])},i=function(){return r("array",arguments[0])},s=function(){return r("string",arguments[0])},o=function(){return r("function",arguments[0])},u=function(){return r("boolean",arguments[0])},l=function(){return arguments[0].indexOf(arguments[1])>-1},c=function(){var e=function(e){var t={};for(var r in e[1])Object.defineProperty(t,r,$.extend({value:e[1][r]},e[2]));return{value:t}};return function(t){for(var r=1,a=arguments.length;r<a;r++)for(var s in arguments[r]){var o=void 0;o=n(arguments[r][s])?{value:c({},arguments[r][s])}:i(arguments[r][s])&&3===arguments[r][s].length&&"descriptor"===arguments[r][s][0]?n(arguments[r][s][1])?e(arguments[r][s]):$.extend({value:arguments[r][s][1]},arguments[r][s][2]):{value:arguments[r][s]},Object.defineProperty(t,s,o)}return t}}(),p=function(){var t=e.location.search.split("?").pop(),r=void 0;switch(arguments.length){case 1:s(arguments[0])&&l(arguments[0],"=")?t=arguments[0]:(i(arguments[0])||s(arguments[0])&&!l(arguments[0],"="))&&(r=arguments[0]);break;case 2:t=arguments[0],r=arguments[1]}if(!t||!l(t,"="))return null;var n=c({},{length:["descriptor",0,{writable:!0}]});return $.each(t.split("&"),function(e,t){var r=t.split("=");2===r.length&&(n[r[0]]=r[1],n.length++)}),s(r)?n[r]:i(r)?function(e,t){return $.each(e,function(e,r){t[r]=n[r],t.length++}),t}(r,c({},{length:["descriptor",0,{writable:!0}]})):void 0===r?n:void 0},h=function(e){var t=e.length;return function(r,n){r=r||16;for(var a="",i=0;i<r;i++){var s=e[Math.floor(Math.random()*t)];if(n)a+=s;else for(;a.indexOf(s)===-1;)a+=s}return a}}([0,1,2,3,4,5,6,7,8,9,"a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]),d=function(){function r(e,t){_classCallCheck(this,r),this.project=e,this.version="3.0.0";var n=t.prefix||"#!",a=n.length,i=t.name||this.project,s=t.version||h(),o=t.root?t.root:"./project/",u=t.apiType||"post",l=t.apiDataType||"json",c=t.apiData||{},p=t.timeout||15e3,d=o+(t.imgDir||"img"),f=o+(t.jsDir||"js"),v=o+(t.tplDir||"tpl"),y=t.debug===!0?".tpl":"-"+s+".tpl",m=t.debug===!0?".js":"-"+s+".js",g=n+(t.homeHash||"index"),b=t.lifeCycle||9e4;this.config={PROJECT_NAME:i,PROJECT_DIR:o,PROJECT_VER:s,HASH_PREFIX:n,HASH_LENGTH:a,API_TYPE:u,API_DATA_TYPE:l,API_DATA:c,IMG_DIR:d,JS_DIR:f,TPL_DIR:v+"/",TPL_EXT_NAME:y,JS_EXT_NAME:m,HOME_HASH:g,TIME_OUT:p,AUTO_DIE_TIME:b}}return _createClass(r,[{key:"router",value:function(){var e=arguments.length<=0||void 0===arguments[0]?"/":arguments[0],t=function(t){return s(t)?0===t.indexOf("http")||0===t.indexOf("//")||0===t.indexOf("/")?t:e+t:null},r=function(e,t){return $.extend({},e,{name:t})},a=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"push",value:function(e){for(var a=arguments.length,c=Array(a>1?a-1:0),h=1;h<a;h++)c[h-1]=arguments[h];var d=e.split("?:"),f=this[e]={name:d[0],param:d[1]?d[1].split(":"):null,path:d[1]?arguments[0].replace(/\?/,"/").replace(/:/g,"~"):d[0],uri:null},v=!0,y=!1,m=void 0;try{for(var g,b=c[Symbol.iterator]();!(v=(g=b.next()).done);v=!0){var _=g.value;if(s(_))"<template"===_.slice(0,9)?f.templ=_:l(_,"=")?f.preset=p(_):f.uri=t(_);else if(i(_)){var w=f.escape={},T=!0,k=!1,E=void 0;try{for(var H,R=_[Symbol.iterator]();!(T=(H=R.next()).done);T=!0){var S=H.value,x=S.split(" => ");w[x[1]]=x[0]}}catch(A){k=!0,E=A}finally{try{!T&&R["return"]&&R["return"]()}finally{if(k)throw E}}}else if(n(_))if(o(_.redirect)&&(f.redirect=_.redirect),u(_.observer)&&(f.observer=_.observer),o(_.proxy)&&(f.proxy=_.proxy),_.hasOwnProperty("status")&&(f.status=_.status),o(_.render)&&(f.render=_.render),s(_.alias))this[_.alias]=r(f,_.alias);else if(i(_.alias)){var P=!0,I=!1,O=void 0;try{for(var M,C=_.alias[Symbol.iterator]();!(P=(M=C.next()).done);P=!0){var D=M.value;this[D]=r(f,D)}}catch(A){I=!0,O=A}finally{try{!P&&C["return"]&&C["return"]()}finally{if(I)throw O}}}}}catch(A){y=!0,m=A}finally{try{!v&&b["return"]&&b["return"]()}finally{if(y)throw m}}return this}}]),e}();return this.routes=new a}},{key:"start",value:function(r){var i=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],u=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],h=null,d=e.document,f=e.location,v=e.history,y=e.sessionStorage,m=this.project,g=this.config,b=this.routes,_=[/{{#header}}/,/{{header#}}/,/{{#container}}/,/{{container#}}/,/{{#title#}}/,/{{#back#}}/,/{{#forward#}}/,/{{#home#}}/,/{{#title}}/,/{{title#}}/],w=[d.body.style.hasOwnProperty("webkitBackdropFilter")?'<header class="page-header backdrop">':'<header class="page-header">',"</header>",'<div class="page-container">',"</div>",'<span class="page-title">{{=it.TITLE}}</span>','<a data-rel="back" class="app-ui-icon app-icon-back icon back"></a>','<a data-rel="forward" class="app-ui-icon app-icon-forward icon forward"></a>','<a data-rel="home" class="app-ui-icon app-icon-home icon home"></a>','<span class="page-title">',"</span>"],T=[w[0]+w[4]+w[5]+w[1]+w[2]+'<div class="app-error"><p class="app-error-desc app-ui-icon app-icon-{{?it.icon}}{{=it.icon}}{{??}}x404{{?}}">{{=it.desc}}{{?it.refresh===true}}，请<a data-rel="refresh" class="refresh app-ui-icon app-icon-refresh">刷新重试</a>{{?}}</p></div>'+w[3]],k=Object.keys(b),E={},H={},R=function(){var e=null,t=function(t){return null===e||e===t?t:(e.pause(),t)};return function(n){return e=t(n).appendTo(r)}}(),S=function(){var t=d.createElement("div"),r=d.createElement("b"),n=d.createElement("i"),a=t.classList,i=!0,s=function(e){e.preventDefault()},o=function(t){t===!1?(e.addEventListener("scroll",s,!1),d.body.addEventListener("touchmove",s,!1),a.add("animated")):t===!0&&(e.removeEventListener("scroll",s,!1),d.body.removeEventListener("touchmove",s,!1),a.remove("animated"))};return t.className="app-spinner",t.appendChild(r),t.appendChild(n),d.body.appendChild(t),function(e){e!==i&&o(i=e)}}(),x=function(){function r(){_classCallCheck(this,r);var t=this;if(n(i))for(var a in i)this[a]=i[a];this.version=g.PROJECT_VER,this.define("PROJECT_NAME",g.PROJECT_NAME),this.define("PROJECT_DIR",g.PROJECT_DIR),this.define("IMG_DIR",g.IMG_DIR),this.define("JS_DIR",g.JS_DIR),this.define("HASH_PREFIX",g.HASH_PREFIX),e.addEventListener("popstate",function(e){if(f.hash!==h.hash&&r.isValidHash(f.hash))return t.request(f.hash,0,2)},!1),$(d.body).on("click",'a[href^="'+g.HASH_PREFIX+'"]',function(e){return e.preventDefault(),t.request(this.getAttribute("href"),this.dataset.state?parseInt(this.dataset.state):void 0)}).on("click","[data-hash]",function(e){return e.preventDefault(),t.request(g.HASH_PREFIX+this.dataset.hash,this.dataset.state?parseInt(this.dataset.state):void 0)}).on("click","a[data-rel]",function(e){switch(e.preventDefault(),this.dataset.rel){case"back":return v.back();case"forward":return v.forward();case"refresh":return t.redirect(f.hash);case"home":return t.request(g.HOME_HASH)}}),u.onReady&&u.onReady(this),r.isValidHash(f.hash)?this.request(f.hash,0,0):this.request(g.HOME_HASH,1)}return _createClass(r,null,[{key:"isValidHash",value:function(e){return e&&e.slice(0,g.HASH_LENGTH)===g.HASH_PREFIX}},{key:"hasTpl",value:function(e){return void 0!==H[e]&&void 0!==H[e]._tpl}},{key:"routeMatch",value:function(e,t){var r=void 0;b.hasOwnProperty(e)&&(e=b[e].name);var n=!0,a=!1,i=void 0;try{for(var s,o=k[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var u=s.value,l=b[u];if(l.name===e)if(null===l.param)r=l;else if(l.param&&t){var c=l.param.length,p=!0,h=!1,d=void 0;try{for(var f,v=l.param[Symbol.iterator]();!(p=(f=v.next()).done);p=!0){var y=f.value;if(t.hasOwnProperty(y)&&0===--c)return l}}catch(m){h=!0,d=m}finally{try{!p&&v["return"]&&v["return"]()}finally{if(h)throw d}}}}}catch(m){a=!0,i=m}finally{try{!n&&o["return"]&&o["return"]()}finally{if(a)throw i}}return r}},{key:"queryMatch",value:function(e,t,r){if(null===e)return void 0!==r?r:e;var n={};if(void 0!==r)for(var a in r)n[a]=r[a];if(void 0!==t)for(var i in e)t.hasOwnProperty(i)?n[t[i]]=e[i]:n[i]=e[i];else for(var s in e)n[s]=e[s];return n}},{key:"parseHash",value:function(e){var t=e.slice(g.HASH_LENGTH).split("?"),n=t[0],a=t[1]?t[1]:"none",i=t[1]?p(t[1]):null,s=r.routeMatch(n,i),o={search:a,hash:e,query:i};return void 0===s?(o.path=n,o.route={uri:null,params:["descriptor",i,{enumerable:!0}],redirect:null,proxy:null,status:1,observer:!1,render:null,templ:null}):(o.path=s.path,o.route={uri:s.uri||null,params:["descriptor",r.queryMatch(i,s.escape,s.preset),{enumerable:!0}],redirect:s.redirect||null,observer:s.observer||!1,templ:s.templ||null,proxy:s.proxy||null,status:s.hasOwnProperty("status")?s.status:1,render:s.render||null}),o}},{key:"getWebView",value:function(e,t,n){var a=void 0,i=r.parseHash(e),s=i.path,o=i.search;return H.hasOwnProperty(s)||(H[s]={}),H[s].hasOwnProperty(o)?(a=H[s][o],"pending"===a.prop.status&&(a.prop.status="restore"),"destroy"===a.prop.status?a.create(n):1===t?a.off().destroy().create(n):2===t&&a.route.observer===!0&&a.off().destroy().create(n)):a=H[s][o]=new A(i,n),a}},{key:"updateTitle",value:function(e){d.title=e||"页面加载中…"}},{key:"transition",value:function(e,t){R(e),r.updateTitle(t),S(!0),u.onTransition&&u.onTransition(e,I)}}]),_createClass(r,[{key:"request",value:function(e,t,a,i){h&&h.stopRequest(),t=void 0===t?f.hash===e?0:2:t,3===arguments.length&&n(arguments[2])&&(a=void 0,i=arguments[2]),0===a&&null===y.getItem(m)&&(v.replaceState(null,null,g.HOME_HASH),y.setItem(m,!0),e!==g.HOME_HASH&&v.pushState(null,null,e)),1===t&&v.replaceState(null,null,e),2===t&&v.pushState(null,null,e);var s=h=r.getWebView(e,void 0===a?1:a,i);if(s.route.redirect){var o=s.route.redirect(s,this);if(o)return this.redirect(o)}r.hasTpl(s.path)?null===s.route.uri||"restore"===s.prop.status?s.applyData():s.runtime.dataXHR=s.ajaxData():(null!==s.route.uri&&(s.runtime.dataXHR=s.ajaxData()),s.route.templ?s.applyTpl(s.route.templ).checkRequest():null===s.route.templ&&(s.runtime.tplXHR=s.ajaxTpl()))}},{key:"redirect",value:function(e,t,r){this.request(e,a(t)?t:1,r)}},{key:"compile",value:function(e,r){return t.compile(e)($.extend({},r,this.define()))}},{key:"define",value:function(e,t){switch(arguments.length){case 0:return E;case 1:return E[e];case 2:var r={};return r[e]=["descriptor",t,{enumerable:!0}],c(E,r,{})}}},{key:"exec",value:function(e){e(h,this)}}]),r}(),A=function(){function t(e,r){_classCallCheck(this,t),c(this,e,{runtime:{enter:[],leave:[],destroy:[],callback:["descriptor",null,{writable:!0}],tplXHR:["descriptor",null,{writable:!0}],dataXHR:["descriptor",null,{writable:!0}]},prop:{status:["descriptor",null,{writable:!0}],timer:["descriptor",0,{writable:!0}],count:["descriptor",0,{writable:!0}],scrollY:["descriptor",0,{writable:!0}]}}).create(r)}return _createClass(t,null,[{key:"parseTpl",value:function(e){for(var t=[],r=void 0,n=0,a=e.replace(/\r\n\s*/g,"").split("</template>"),i=a.length;n<i;n++){var s=a[n];if(0!==s.length){var o=s.indexOf(">")+1,u=s.slice(o);if(0===n){r=s.slice(0,o).match(/data-title="(.*)"/);for(var c=0,p=_.length;c<p;c++)l(u,_[c].source)&&(u=u.replace(_[c],w[c]))}t.push(u)}}return{tpl:t,title:r?r[1]:r}}}]),_createClass(t,[{key:"create",value:function(e){var t=d.createElement("div");return t.className="app-page",this.state={},this.render=e||null,this.$webview=$(t),this.prop.status="ready",this.prop.timer=0,this.prop.count=0,this.prop.scrollY=0,P.push(this)}},{key:"on",value:function(e,t){var r=this.runtime;if(2===arguments.length)switch(e){case"enter":t(),r.enter.push(t);break;case"leave":r.leave.push(t);break;case"die":r.destroy.push(t)}else o(arguments[0].listen)&&(arguments[0].listen(),this.route.observer===!1&&r.enter.push(arguments[0].listen)),o(arguments[0].pend)&&r.leave.push(arguments[0].pend),o(arguments[0].destroy)&&r.destroy.push(arguments[0].destroy);return this}},{key:"off",value:function(){var e=this.runtime,t=e.leave,r=e.enter,n=!0,a=!1,i=void 0;try{for(var s,o=t[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var u=s.value;u()}}catch(l){a=!0,i=l}finally{try{!n&&o["return"]&&o["return"]()}finally{if(a)throw i}}return t.splice(0,t.length),this.route.observer===!1&&r.splice(0,r.length),this}},{key:"pause",value:function(){var t=!0,r=!1,n=void 0;try{for(var a,i=this.runtime.leave[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var s=a.value;s()}}catch(o){r=!0,n=o}finally{try{!t&&i["return"]&&i["return"]()}finally{if(r)throw n}}return this.prop.status="pending",this.prop.scrollY=e.scrollY,this.prop.count++,this.$webview.detach(),this}},{key:"destroy",value:function(e){var t=this.runtime.destroy,r=!0,n=!1,a=void 0;try{for(var i,s=t[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var o=i.value;o()}}catch(u){n=!0,a=u}finally{try{!r&&s["return"]&&s["return"]()}finally{if(n)throw a}}return t.splice(0,t.length),this.$webview.remove(),this.prop.status="destroy",this.runtime.callback=null,P.remove(this)}},{key:"checkRequest",value:function(){null!==this.runtime.dataXHR&&null!==this.runtime.tplXHR||this.applyData()}},{key:"stopRequest",value:function(e,t,r){if(S(!!e),this.runtime.tplXHR&&this.runtime.tplXHR.abort(),this.runtime.dataXHR&&this.runtime.dataXHR.abort(),e){if(this.render)return this.applyData(T);this.render={desc:e,refresh:r,icon:t},this.applyData(T)}}},{key:"ajaxData",value:function(){var e=this;return $.ajax({url:this.route.uri,type:g.API_TYPE,data:this.route.params?$.extend({},this.route.params,g.API_DATA):g.API_DATA,dataType:g.API_DATA_TYPE,timeout:g.TIME_OUT}).done(function(t){if(o(e.route.proxy)&&(t=e.route.proxy(t,e,I)),void 0===t||null===t||t===!1)return t;if(void 0===t.status)e.stopRequest("返回的数据无status");else if(t.status===(e.route.status||1)){if(0===t.render.status)return e.stopRequest("您访问的页面不存在");e.render=$.extend(e.render,t.render),e.checkRequest()}else e.stopRequest(t.msg||"服务器发生未知错误","debug")}).fail(function(t,r,n){switch(r){case"error":switch(t.status){case 404:e.stopRequest("您访问的页面未找到");break;default:e.stopRequest("服务器发生错误","debug",!0)}break;case"abort":e.stopRequest("页面请求被中止");break;case"timeout":e.stopRequest("您的网络不给力","wifi-error",!0);break;case"parsererror":e.stopRequest("数据格式错误","debug")}}).always(function(){e.runtime.dataXHR=null})}},{key:"applyData",value:function(e){this.templ||c(this,{templ:H[this.path]._tpl});var t=this.render=this.render||{},r=this.route.render,n=void 0,a=H[this.path]._title||I.define("PROJECT_NAME");return"restore"===this.prop.status?x.transition(this,a):(null!==r&&(n=o(r)?r(t,this,I):r),this.$webview.append(this.compile(e||this.templ[0],n?$.extend(t,n):t,a)),void x.transition(this,a))}},{key:"ajaxTpl",value:function(){var e=this;return $.ajax({url:g.TPL_DIR+this.path+g.TPL_EXT_NAME,type:"GET",dataType:"html",timeout:g.TIME_OUT}).done(function(t){e.applyTpl(t).checkRequest()}).fail(function(t,r){switch(r){case"error":e.stopRequest("您访问的页面不存在");break;case"timeout":e.stopRequest("您的网络不给力","wifi-error",!0)}}).always(function(){e.runtime.tplXHR=null})}},{key:"applyTpl",value:function(e){var r=t.parseTpl(e);return H[this.path]._tpl=r.tpl,H[this.path]._title=r.title,this}},{key:"compile",value:function(e,t,r){return I.compile(e,$.extend({TITLE:r,JS_FILE:this.path+g.JS_EXT_NAME},t))}},{key:"exec",value:function(e){switch(this.prop.status){case"pending":this.runtime.callback=function(){this.runtime.callback=null,e(I,this)};break;case"ready":case"active":case"restore":e(I,this)}}},{key:"appendTo",value:function(t){if(this.$webview.appendTo(t),"restore"===this.prop.status){this.runtime.callback&&this.runtime.callback(),e.scrollTo(0,this.prop.scrollY);var r=!0,n=!1,a=void 0;try{for(var i,s=this.runtime.enter[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var o=i.value;o()}}catch(u){n=!0,a=u}finally{try{!r&&s["return"]&&s["return"]()}finally{if(n)throw a}}}else e.scrollTo(0,0);return this.prop.status="active",this.prop.timer=0,this}},{key:"setState",value:function(){if(0===arguments.length)return this.state;if(1===arguments.length&&s(arguments[0]))return this.state[arguments[0]];if(2===arguments.length&&s(arguments[0]))this.state[arguments[0]]=arguments[1];else{var e=!0,t=!1,r=void 0;try{for(var n,a=arguments[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){var i=n.value;$.extend(this.state,i)}}catch(o){t=!0,r=o}finally{try{!e&&a["return"]&&a["return"]()}finally{if(t)throw r}}}return this.state}}]),t}(),P=new(function(){function e(){_classCallCheck(this,e);var t=this.trashArr=[],r=4500,n=function(e){e&&"pending"===e.prop.status&&(e.prop.timer>=g.AUTO_DIE_TIME+e.prop.count*r?e.off().destroy():e.prop.timer+=r)},a=function(){var e=!0,r=!1,a=void 0;try{for(var i,s=t[Symbol.iterator]();!(e=(i=s.next()).done);e=!0){var o=i.value;n(o)}}catch(u){r=!0,a=u}finally{try{!e&&s["return"]&&s["return"]()}finally{if(r)throw a}}};setInterval(a,r)}return _createClass(e,[{key:"push",value:function(e){return this.trashArr.push(e),e}},{key:"remove",value:function(e){return this.trashArr.splice(this.trashArr.indexOf(e),1),e}}]),e}()),I=this.controller=e.App=new x;return this}}]),r}();return d},function(e){function t(e,r,n){return("string"==typeof r?r:r.toString()).replace(e.define||i,function(t,r,a,i){return 0===r.indexOf("def.")&&(r=r.substring(4)),r in n||(":"===a?(e.defineParams&&i.replace(e.defineParams,function(e,t,a){n[r]={arg:t,text:a}}),r in n||(n[r]=i)):new Function("def","def['"+r+"']="+i)(n)),""}).replace(e.use||i,function(r,a){e.useParams&&(a=a.replace(e.useParams,function(e,t,r,a){if(n[r]&&n[r].arg&&a){var i=(r+":"+a).replace(/'|\\/g,"_");return n.__exp=n.__exp||{},n.__exp[i]=n[r].text.replace(new RegExp("(^|[^\\w$])"+n[r].arg+"([^\\w$])","g"),"$1"+a+"$2"),t+"def.__exp['"+i+"']"}}));var i=new Function("def","return "+a)(n);return i?t(e,i,n):i})}function r(e){return e.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}var n={version:"1.0.3",templateSettings:{evaluate:/\{\{([\s\S]+?(\}?)+)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,useParams:/(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,defineParams:/^\s*([\w$]+):([\s\S]+)/,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,varname:"it",strip:!0,append:!0,selfcontained:!1,doNotSkipEncoded:!1},template:void 0,compile:void 0};n.encodeHTMLSource=function(e){var t={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},r=e?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(e){return e?e.toString().replace(r,function(e){return t[e]||e}):""}};var a={append:{start:"'+(",end:")+'",startencode:"'+encodeHTML("},split:{start:"';out+=(",end:");out+='",startencode:"';out+=encodeHTML("}},i=/$^/;return n.template=function(s,o,u){o=o||n.templateSettings;var l,c,p=o.append?a.append:a.split,h=0,d=o.use||o.define?t(o,s,u||{}):s;d=("var out='"+(o.strip?d.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):d).replace(/'|\\/g,"\\$&").replace(o.interpolate||i,function(e,t){return p.start+r(t)+p.end}).replace(o.encode||i,function(e,t){return l=!0,p.startencode+r(t)+p.end}).replace(o.conditional||i,function(e,t,n){return t?n?"';}else if("+r(n)+"){out+='":"';}else{out+='":n?"';if("+r(n)+"){out+='":"';}out+='"}).replace(o.iterate||i,function(e,t,n,a){return t?(h+=1,c=a||"i"+h,t=r(t),"';var arr"+h+"="+t+";if(arr"+h+"){var "+n+","+c+"=-1,l"+h+"=arr"+h+".length-1;while("+c+"<l"+h+"){"+n+"=arr"+h+"["+c+"+=1];out+='"):"';} } out+='"}).replace(o.evaluate||i,function(e,t){return"';"+r(t)+"out+='"})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|\}|^|\{)out\+='';/g,"$1").replace(/\+''/g,""),l&&(o.selfcontained||!e||e._encodeHTML||(e._encodeHTML=n.encodeHTMLSource(o.doNotSkipEncoded)),d="var encodeHTML = typeof _encodeHTML !== 'undefined' ? _encodeHTML : ("+n.encodeHTMLSource.toString()+"("+(o.doNotSkipEncoded||"")+"));"+d);try{return new Function(o.varname,d)}catch(f){throw"undefined"!=typeof console&&console.log("Could not create a template function: "+d),f}},n.compile=function(e,t){return n.template(e,null,t)},n});